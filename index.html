<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Family Calendar App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- React + ReactDOM + Babel (voor JSX in de browser) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7ff, #fef6ff);
      color: #1f2933;
      padding: 20px;
    }

    #root {
      max-width: 1200px;
      margin: 0 auto;
    }

    .app-shell {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      padding: 18px 20px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      font-weight: 600;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .calendar-title {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .calendar-title span:first-child {
      font-size: 1.3rem;
      font-weight: 700;
    }

    .calendar-title span:last-child {
      font-size: 0.85rem;
      color: #6b7280;
    }

    .calendar-nav {
      display: flex;
      gap: 8px;
    }

    button {
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      background: #eef2ff;
      color: #4f46e5;
      font-weight: 600;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .btn:hover {
      background: #e0e7ff;
      transform: translateY(-1px);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid #e5e7eb;
      color: #374151;
    }

    .btn-outline:hover {
      background: #f3f4f6;
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-top: 8px;
    }

    .weekday {
      text-align: center;
      font-size: 0.75rem;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: #6b7280;
      padding-bottom: 4px;
    }

    .day-cell {
      min-height: 80px;
      background: #f9fafb;
      border-radius: 12px;
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      border: 1px solid transparent;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.05s ease;
      position: relative;
    }

    .day-cell:hover {
      background: #f3f4ff;
      border-color: #e0e7ff;
      transform: translateY(-1px);
    }

    .day-cell.other-month {
      opacity: 0.35;
    }

    .day-number {
      font-size: 0.8rem;
      font-weight: 600;
      color: #6b7280;
      margin-bottom: 2px;
    }

    .day-number.today {
      color: #f97316;
      font-weight: 800;
    }

    .event-pill {
      padding: 4px 6px;
      border-radius: 10px;
      background: #eef2ff;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
      cursor: pointer;
    }

    .event-pill:hover {
      background: #e0e7ff;
    }

    .event-pill-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .event-title {
      font-weight: 600;
      font-size: 0.7rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .event-time {
      font-size: 0.65rem;
      color: #6b7280;
    }

    .event-avatars {
      display: flex;
      gap: 2px;
    }

    .avatar {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      font-size: 0.65rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      border: 1px solid rgba(15, 23, 42, 0.08);
    }

    .thumb-btn {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      font-size: 0.75rem;
      padding: 2px 5px;
      border-radius: 999px;
      background: #fff;
      color: #6b7280;
      border: 1px solid #e5e7eb;
    }

    .thumb-btn.active {
      background: #4ade80;
      border-color: #22c55e;
      color: #064e3b;
      font-weight: 700;
    }

    .thumb-btn span.icon {
      font-size: 0.9rem;
    }

    .sidebar-section {
      margin-bottom: 18px;
    }

    .sidebar-section p {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 3px;
      margin-bottom: 8px;
    }

    .field label {
      font-size: 0.75rem;
      font-weight: 600;
      color: #4b5563;
    }

    .field input,
    .field textarea {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 6px 8px;
      font-size: 0.85rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      resize: vertical;
    }

    .field input:focus,
    .field textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.25);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      border: 1px solid #e5e7eb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f9fafb;
    }

    .chip.active {
      background: #eef2ff;
      border-color: #6366f1;
      color: #4338ca;
      font-weight: 600;
    }

    .chip-color-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .members-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .member-tag {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #f3f4f6;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .member-name {
      font-weight: 500;
    }

    .member-delete-btn {
      border-radius: 999px;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      background: #e5e7eb;
      color: #4b5563;
    }

    .member-delete-btn:hover {
      background: #fecaca;
      color: #991b1b;
    }

    .muted {
      color: #9ca3af;
      font-size: 0.8rem;
    }

    .divider {
      height: 1px;
      background: #e5e7eb;
      margin: 10px 0;
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useMemo, useEffect } = React;

// URL voor in WhatsApp-berichten
const APP_URL = window.location.origin + window.location.pathname;

// Helpers
function formatDateKey(date) {
  return date.toISOString().slice(0, 10);
}

function getCalendarDays(year, monthIndex) {
  const firstOfMonth = new Date(year, monthIndex, 1);
  const startDay = firstOfMonth.getDay(); // 0 = Sun
  const offset = (startDay + 6) % 7;      // Monday = 0

  const days = [];
  const firstCellDate = new Date(year, monthIndex, 1 - offset);

  for (let i = 0; i < 42; i++) {
    const d = new Date(firstCellDate);
    d.setDate(firstCellDate.getDate() + i);
    days.push(d);
  }
  return days;
}

const WEEKDAYS = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

const COLOR_PALETTE = [
  "#f97316", // orange
  "#6366f1", // indigo
  "#ec4899", // pink
  "#22c55e", // green
  "#06b6d4", // cyan
  "#a855f7", // purple
];

function App() {
  const today = new Date();
  const [currentMonth, setCurrentMonth] = useState(today.getMonth());
  const [currentYear, setCurrentYear] = useState(today.getFullYear());

  const [familyMembers, setFamilyMembers] = useState([
    { id: 1, name: "You", color: "#6366f1" },
    { id: 2, name: "Alex", color: "#f97316" },
    { id: 3, name: "Taylor", color: "#22c55e" },
  ]);

  const [currentUserId, setCurrentUserId] = useState(1);

  const [events, setEvents] = useState([
    {
      id: 1,
      title: "Sunday brunch",
      date: formatDateKey(today),
      time: "11:00",
      description: "Family brunch at grandma's",
      invitedMemberIds: [1, 2, 3],
      joinedMemberIds: [1, 2],
    }
  ]);

  const calendarDays = useMemo(
    () => getCalendarDays(currentYear, currentMonth),
    [currentYear, currentMonth]
  );

  const monthNames = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
  ];

  const handlePrevMonth = () => {
    if (currentMonth === 0) {
      setCurrentMonth(11);
      setCurrentYear(y => y - 1);
    } else {
      setCurrentMonth(m => m - 1);
    }
  };

  const handleNextMonth = () => {
    if (currentMonth === 11) {
      setCurrentMonth(0);
      setCurrentYear(y => y + 1);
    } else {
      setCurrentMonth(m => m + 1);
    }
  };

  const handleAddMember = (name) => {
    if (!name.trim()) return;
    const nextColor = COLOR_PALETTE[familyMembers.length % COLOR_PALETTE.length];
    const newMember = {
      id: Date.now(),
      name: name.trim(),
      color: nextColor,
    };
    setFamilyMembers(prev => [...prev, newMember]);
  };

  const handleDeleteMember = (memberId) => {
    setFamilyMembers(prev => {
      if (prev.length === 1) {
        alert("You need at least one family member in the calendar.");
        return prev;
      }
      const updated = prev.filter(m => m.id !== memberId);
      setCurrentUserId(prevId =>
        prevId === memberId ? (updated[0]?.id ?? null) : prevId
      );
      return updated;
    });

    setEvents(prev =>
      prev.map(ev => ({
        ...ev,
        invitedMemberIds: (ev.invitedMemberIds || []).filter(id => id !== memberId),
        joinedMemberIds: (ev.joinedMemberIds || []).filter(id => id !== memberId),
      }))
    );
  };

  const handleAddEvent = (eventData) => {
    const newEvent = {
      id: Date.now(),
      title: eventData.title.trim(),
      date: eventData.date,
      time: eventData.time,
      description: eventData.description.trim(),
      invitedMemberIds: eventData.invitedMemberIds,
      joinedMemberIds: eventData.joinedMemberIds || [],
    };
    setEvents(prev => [...prev, newEvent]);
  };

  const handleToggleJoin = (eventId, memberId) => {
    if (!memberId) {
      alert("Please select who you are first in the Family section.");
      return;
    }
    setEvents(prev =>
      prev.map(ev => {
        if (ev.id !== eventId) return ev;
        const joined = new Set(ev.joinedMemberIds || []);
        if (joined.has(memberId)) joined.delete(memberId);
        else joined.add(memberId);
        return { ...ev, joinedMemberIds: Array.from(joined) };
      })
    );
  };

  const handleShareWhatsApp = () => {
    const text =
      "Join our family calendar üë®‚Äçüë©‚Äçüëß\n\nOpen this link on your phone or computer:\n" +
      APP_URL;
    const url = "https://wa.me/?text=" + encodeURIComponent(text);
    window.open(url, "_blank");
  };

  const currentUser = familyMembers.find(m => m.id === currentUserId);

  return (
    <div className="app-shell">
      {/* Calendar */}
      <div className="card">
        <div className="calendar-header">
          <div className="calendar-title">
            <span>{monthNames[currentMonth]} {currentYear}</span>
            <span>Family calendar</span>
          </div>
          <div className="calendar-nav">
            <button className="btn-outline btn" onClick={handlePrevMonth}>
              ‚Üê Prev
            </button>
            <button className="btn-outline btn" onClick={() => {
              setCurrentMonth(today.getMonth());
              setCurrentYear(today.getFullYear());
            }}>
              Today
            </button>
            <button className="btn-outline btn" onClick={handleNextMonth}>
              Next ‚Üí
            </button>
          </div>
        </div>

        <div className="calendar-grid">
          {WEEKDAYS.map(d => (
            <div key={d} className="weekday">{d}</div>
          ))}

          {calendarDays.map((date, idx) => {
            const dateKey = formatDateKey(date);
            const dayEvents = events.filter(ev => ev.date === dateKey);

            const isCurrentMonth = date.getMonth() === currentMonth;
            const isToday = date.toDateString() === today.toDateString();

            return (
              <div
                key={idx}
                className={"day-cell" + (isCurrentMonth ? "" : " other-month")}
              >
                <div className={"day-number" + (isToday ? " today" : "")}>
                  {date.getDate()}
                </div>
                {dayEvents.map(ev => {
                  const joined = new Set(ev.joinedMemberIds || []);
                  const joinedMembers = familyMembers.filter(m => joined.has(m.id));
                  const isCurrentUserJoined = joined.has(currentUserId);

                  return (
                    <div key={ev.id} className="event-pill" title={ev.description}>
                      <div className="event-pill-main">
                        <div className="event-title">{ev.title}</div>
                        <div className="event-time">{ev.time || "All day"}</div>
                      </div>
                      <div style={{ display: "flex", flexDirection: "column", alignItems: "flex-end", gap: 3 }}>
                        <div className="event-avatars">
                          {joinedMembers.slice(0, 3).map(m => (
                            <div
                              key={m.id}
                              className="avatar"
                              style={{ background: m.color }}
                              title={m.name}
                            >
                              {m.name[0].toUpperCase()}
                            </div>
                          ))}
                          {joinedMembers.length > 3 && (
                            <div className="avatar" style={{ background: "#9ca3af" }}>
                              +{joinedMembers.length - 3}
                            </div>
                          )}
                        </div>
                        <button
                          className={"thumb-btn" + (isCurrentUserJoined ? " active" : "")}
                          onClick={() => handleToggleJoin(ev.id, currentUserId)}
                        >
                          <span className="icon">üëç</span>
                          <span>{joinedMembers.length || 0}</span>
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>
            );
          })}
        </div>
      </div>

      {/* Sidebar */}
      <div className="card">
        {/* Current user / switcher */}
        <div className="sidebar-section">
          <div className="card-header">
            <div className="card-title">
              üë®‚Äçüë©‚Äçüëß Family
              <span className="badge">Who are you?</span>
            </div>
          </div>
          <p>Pick yourself so your üëç joins events with the right avatar.</p>
          <div className="chip-row">
            {familyMembers.map(m => (
              <button
                key={m.id}
                className={"chip" + (m.id === currentUserId ? " active" : "")}
                onClick={() => setCurrentUserId(m.id)}
              >
                <span
                  className="chip-color-dot"
                  style={{ background: m.color }}
                />
                <span>{m.name}</span>
                {m.id === currentUserId && <span>‚úì</span>}
              </button>
            ))}
          </div>
        </div>

        <div className="divider" />

        {/* Add member + WhatsApp invite */}
        <AddMemberSection
          onAddMember={handleAddMember}
          familyMembers={familyMembers}
          onDeleteMember={handleDeleteMember}
          onShareWhatsApp={handleShareWhatsApp}
        />

        <div className="divider" />

        {/* Add event */}
        <AddEventSection
          onAddEvent={handleAddEvent}
          familyMembers={familyMembers}
          currentDateKey={formatDateKey(today)}
          currentUserId={currentUserId}
        />
      </div>
    </div>
  );
}

function AddMemberSection({ onAddMember, familyMembers, onDeleteMember, onShareWhatsApp }) {
  const [name, setName] = useState("");

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!name.trim()) return;
    onAddMember(name);
    setName("");
  };

  return (
    <div className="sidebar-section">
      <div className="card-header">
        <div className="card-title">
          üì® Invite family
          <span className="badge">Members</span>
        </div>
      </div>
      <p>
        Add everyone in the house so they can be invited to events.
        You can also share the calendar link via WhatsApp.
      </p>

      <form onSubmit={handleSubmit}>
        <div className="field">
          <label>Family member name</label>
          <input
            type="text"
            placeholder="e.g. Mom, Dad, Emma..."
            value={name}
            onChange={e => setName(e.target.value)}
          />
        </div>
        <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
          <button className="btn" type="submit">
            + Add member
          </button>
          <button
            className="btn btn-secondary"
            type="button"
            onClick={onShareWhatsApp}
          >
            üì≤ Invite via WhatsApp
          </button>
        </div>
      </form>

      <div className="members-list">
        {familyMembers.map(m => (
          <div key={m.id} className="member-tag">
            <span
              className="chip-color-dot"
              style={{ background: m.color }}
            />
            <span className="member-name">{m.name}</span>
            <button
              type="button"
              className="member-delete-btn"
              title="Delete member"
              onClick={() => onDeleteMember(m.id)}
            >
              √ó
            </button>
          </div>
        ))}
      </div>
    </div>
  );
}

function AddEventSection({ onAddEvent, familyMembers, currentDateKey, currentUserId }) {
  const [title, setTitle] = useState("");
  const [date, setDate] = useState(currentDateKey);
  const [time, setTime] = useState("");
  const [description, setDescription] = useState("");
  const [invitedIds, setInvitedIds] = useState(
    familyMembers.map(m => m.id)
  );

  useEffect(() => {
    setInvitedIds(familyMembers.map(m => m.id));
  }, [familyMembers.length]);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!title.trim() || !date) return;

    onAddEvent({
      title,
      date,
      time,
      description,
      invitedMemberIds: invitedIds,
      joinedMemberIds: currentUserId ? [currentUserId] : [],
    });

    setTitle("");
    setTime("");
    setDescription("");
    setDate(currentDateKey);
  };

  const toggleInvited = (memberId) => {
    setInvitedIds(prev => {
      const s = new Set(prev);
      if (s.has(memberId)) s.delete(memberId);
      else s.add(memberId);
      return Array.from(s);
    });
  };

  return (
    <div className="sidebar-section">
      <div className="card-header">
        <div className="card-title">
          üìÖ New appointment
          <span className="badge">Event</span>
        </div>
      </div>
      <p>Create an appointment and invite your family. Everyone can tap üëç to join.</p>

      <form onSubmit={handleSubmit}>
        <div className="field">
          <label>Title</label>
          <input
            type="text"
            placeholder="e.g. Movie night, Dentist, Soccer practice..."
            value={title}
            onChange={e => setTitle(e.target.value)}
          />
        </div>

        <div className="field">
          <label>Date</label>
          <input
            type="date"
            value={date}
            onChange={e => setDate(e.target.value)}
          />
        </div>

        <div className="field">
          <label>Time (optional)</label>
          <input
            type="time"
            value={time}
            onChange={e => setTime(e.target.value)}
          />
        </div>

        <div className="field">
          <label>Description (optional)</label>
          <textarea
            rows="2"
            placeholder="Add details like address or what to bring..."
            value={description}
            onChange={e => setDescription(e.target.value)}
          />
        </div>

        <div className="field">
          <label>Invite</label>
          <div className="chip-row">
            {familyMembers.map(m => (
              <button
                type="button"
                key={m.id}
                className={"chip" + (invitedIds.includes(m.id) ? " active" : "")}
                onClick={() => toggleInvited(m.id)}
              >
                <span
                  className="chip-color-dot"
                  style={{ background: m.color }}
                />
                <span>{m.name}</span>
              </button>
            ))}
          </div>
        </div>

        <button className="btn" type="submit">
          + Add appointment
        </button>
      </form>
      <p className="muted" style={{ marginTop: 6 }}>
        Tip: The person creating the appointment auto-joins with üëç when you‚Äôve selected who you are.
      </p>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
</script>
</body>
</html>
